/* (c) Copyright 2003-2021, Real-Time Innovations, Inc. All rights reserved. */
/*
 * @(#)osapi_context.h    generated by: makeheader    Fri Apr 23 00:09:52 2021
 *
 *		built from:	context.ifc
 */

#ifndef osapi_context_h
#define osapi_context_h


  #ifndef log_common_h
    #include "log/log_common.h"
  #endif
  #ifndef osapi_dll_h
    #include "osapi/osapi_dll.h"
  #endif
  #ifndef osapi_type_h
    #include "osapi/osapi_type.h"
  #endif
  #ifndef osapi_thread_h
    #include "osapi/osapi_thread.h"
  #endif
  #ifndef osapi_heap_h
    #include "osapi/osapi_heap.h"
  #endif
  #ifndef osapi_utility_h
    #include "osapi/osapi_utility.h"
  #endif
#ifdef __cplusplus
    extern "C" {
#endif


#define RTI_OSAPI_CONTEXT_STRING_SIZE_MAX 512


#define RTI_OSAPI_CONTEXT_STACK_SIZE_DEFAULT 32


#define RTI_OSAPI_ACTIVITY_CONTEXT_INDEX 0
#define RTI_OSAPI_HEAP_CONTEXT_INDEX 1


struct RTIOsapiContextEntry {
    void *entry;
    /* If the context is cached in expansion, expansionEnd points to end */
    char *expansionEnd;
};


struct RTIOsapiContext {
    /* List of entries */
    struct RTIOsapiContextEntry *entries;
    RTI_UINT32 maxEntryCount;
    /* Position on the list */
    RTI_UINT32 top;
    /* It is used to cache the context into a string */
    char *expansion;
};

extern RTIOsapiDllExport
RTIBool RTIOsapiContextSupport_enable(RTIOsapiThreadTssFactory *tssFactory);

extern RTIOsapiDllExport
void RTIOsapiContextSupport_disable(void);

extern RTIOsapiDllExport
RTIBool RTIOsapiContextSupport_assertContextTss(
        RTI_UINT32 contextIndex,
        RTIBool addContextTssToGlobalList,
        RTI_UINT32 maxEntryCount,
        RTI_UINT32 maxExpansionSize);

extern RTIOsapiDllExport
void RTIOsapiContextSupport_finalizeContextTss(void);

extern RTIOsapiDllExport
struct RTIOsapiContext * RTIOsapiContextSupport_getContext(
        RTI_UINT32 contextIndex);

extern RTIOsapiDllExport
RTIBool RTIOsapiContext_enter(RTI_UINT32 contextIndex, void *entry);

extern RTIOsapiDllExport
void RTIOsapiContext_enterPair(
        struct RTIOsapiContext *self,
        RTI_UINT32 contextIndex,
        void *entry1,
        void *entry2);

extern RTIOsapiDllExport
RTIBool RTIOsapiContext_enterGroup(
        RTI_UINT32 contextIndex,
        RTI_UINT32 groupSize,
        ...);

extern RTIOsapiDllExport
RTIBool RTIOsapiContext_leave(RTI_UINT32 contextIndex);

extern RTIOsapiDllExport
void RTIOsapiContext_leaveGroup(
        struct RTIOsapiContext *self,
        RTI_UINT32 contextIndex,
        RTI_UINT32 groupSize);

extern RTIOsapiDllExport
RTI_UINT32 RTIOsapiContext_getDepth(RTI_UINT32 contextIndex);

extern RTIOsapiDllExport
void RTIOsapiContextScope_begin(void);

extern RTIOsapiDllExport
void RTIOsapiContextScope_end(void);


#ifdef __cplusplus
    }	/* extern "C" */
#endif
#include "osapi/osapi_context_impl.h"

#endif /* osapi_context_h */
